<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ê¸°ì‚¬ ê²Œì‹œíŒ | AI ë‰´ìŠ¤</title>
  <meta name="description" content="AI ë‰´ìŠ¤ ê¸°ì‚¬ ê²Œì‹œíŒ - ìµœì‹  AI ë‰´ìŠ¤ì™€ ê¸°ì‚¬ë¥¼ í™•ì¸í•˜ì„¸ìš”">
  <link rel="stylesheet" href="css/board.css">
</head>
<body>

<header class="board-header">
  <div class="wrap">
    <h1><a href="index.html">AI ë‰´ìŠ¤</a></h1>
    <nav class="header-nav">
      <a href="index.html">ì¹´ë“œë‰´ìŠ¤</a>
      <a href="board.html" style="background:rgba(45,134,89,.12)">ê¸°ì‚¬ ê²Œì‹œíŒ</a>
      <a href="admin.html">ê´€ë¦¬ì</a>
    </nav>
  </div>
</header>

<div class="content-wrap">
  <!-- ê²€ìƒ‰/í•„í„° -->
  <div class="toolbar">
    <input type="text" id="search-input" placeholder="ê¸°ì‚¬ ê²€ìƒ‰...">
    <select id="category-filter">
      <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
      <option value="AI">AI</option>
      <option value="ì‚°ì—…">ì‚°ì—…</option>
      <option value="ê¸°ìˆ ">ê¸°ìˆ </option>
      <option value="ì •ì±…">ì •ì±…</option>
      <option value="ì¼ë°˜">ì¼ë°˜</option>
    </select>
    <button class="btn btn-primary" onclick="loadArticles()">ê²€ìƒ‰</button>
  </div>

  <!-- ê¸°ì‚¬ ëª©ë¡ -->
  <div id="article-list">
    <div class="loading">ê¸°ì‚¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div class="pagination" id="pagination"></div>
</div>

<footer class="board-footer">
  &copy; 2026 AI ë‰´ìŠ¤ &middot; <a href="index.html">ì¹´ë“œë‰´ìŠ¤ í™ˆ</a>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-config.js"></script>
<script>
  const PAGE_SIZE = 10;
  let currentPage = 1;
  let totalCount = 0;

  // ê¸°ì‚¬ ëª©ë¡ ë¡œë“œ
  async function loadArticles() {
    const listEl = document.getElementById('article-list');
    const searchQuery = document.getElementById('search-input').value.trim();
    const category = document.getElementById('category-filter').value;

    listEl.innerHTML = '<div class="loading">ê¸°ì‚¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>';

    const from = (currentPage - 1) * PAGE_SIZE;
    const to = from + PAGE_SIZE - 1;

    let query = supabase
      .from('articles')
      .select('id, title, author, category, view_count, created_at, published', { count: 'exact' })
      .eq('published', true)
      .order('created_at', { ascending: false })
      .range(from, to);

    if (searchQuery) {
      query = query.ilike('title', `%${searchQuery}%`);
    }
    if (category) {
      query = query.eq('category', category);
    }

    const { data, error, count } = await query;

    if (error) {
      listEl.innerHTML = '<div class="alert alert-error">ê¸°ì‚¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message + '</div>';
      return;
    }

    totalCount = count || 0;

    if (!data || data.length === 0) {
      listEl.innerHTML = '<div class="empty-state"><div class="emoji">ğŸ“­</div><p>ë“±ë¡ëœ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
      document.getElementById('pagination').innerHTML = '';
      return;
    }

    let html = `
      <table class="board-table">
        <thead>
          <tr>
            <th style="width:50%">ì œëª©</th>
            <th>ì¹´í…Œê³ ë¦¬</th>
            <th>ì‘ì„±ì</th>
            <th>ì‘ì„±ì¼</th>
            <th>ì¡°íšŒ</th>
          </tr>
        </thead>
        <tbody>
    `;

    data.forEach(article => {
      const date = new Date(article.created_at).toLocaleDateString('ko-KR');
      html += `
        <tr>
          <td class="title-cell">
            <a href="article.html?id=${article.id}">${escapeHtml(article.title)}</a>
          </td>
          <td><span class="category-badge">${escapeHtml(article.category || 'ì¼ë°˜')}</span></td>
          <td>${escapeHtml(article.author || 'ê´€ë¦¬ì')}</td>
          <td>${date}</td>
          <td>${article.view_count || 0}</td>
        </tr>
      `;
    });

    html += '</tbody></table>';
    listEl.innerHTML = html;

    renderPagination();
  }

  // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
  function renderPagination() {
    const totalPages = Math.ceil(totalCount / PAGE_SIZE);
    const paginationEl = document.getElementById('pagination');

    if (totalPages <= 1) {
      paginationEl.innerHTML = '';
      return;
    }

    let html = '';
    html += `<button ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">&laquo; ì´ì „</button>`;

    const startPage = Math.max(1, currentPage - 2);
    const endPage = Math.min(totalPages, currentPage + 2);

    if (startPage > 1) {
      html += `<button onclick="goToPage(1)">1</button>`;
      if (startPage > 2) html += `<button disabled>...</button>`;
    }

    for (let i = startPage; i <= endPage; i++) {
      html += `<button class="${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
    }

    if (endPage < totalPages) {
      if (endPage < totalPages - 1) html += `<button disabled>...</button>`;
      html += `<button onclick="goToPage(${totalPages})">${totalPages}</button>`;
    }

    html += `<button ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">ë‹¤ìŒ &raquo;</button>`;

    paginationEl.innerHTML = html;
  }

  function goToPage(page) {
    currentPage = page;
    loadArticles();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // HTML ì´ìŠ¤ì¼€ì´í”„
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // ì—”í„°í‚¤ ê²€ìƒ‰
  document.getElementById('search-input').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      currentPage = 1;
      loadArticles();
    }
  });

  // ì´ˆê¸° ë¡œë“œ
  loadArticles();
</script>

</body>
</html>
